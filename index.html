
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
  <title>Post-Ṣalāh Adhkār</title>
  <meta name="description" content="Phone-friendly checklist of post-ṣalāh adhkār with Arabic and transliteration, tap-to-count, and local save.">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0a0a0a">
  <!-- iOS PWA meta -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Adhkar">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <style>
    :root {
      --bg: #0b0b0c;
      --card: #141416;
      --muted: #9aa0a6;
      --text: #f1f3f4;
      --accent: #4f8cff;
      --good: #22c55e;
      --border: #2a2b2f;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; padding: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: var(--bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .container { max-width: 920px; margin: 0 auto; padding: calc(16px + env(safe-area-inset-top) + 8px) 16px calc(20px + env(safe-area-inset-bottom)); }
    header { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    h1 { margin: 0; font-size: 20px; }
    .tabs { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin: 12px 0 8px; }
    .tab { padding: 10px 8px; border: 1px solid var(--border); background: var(--card); color: var(--text); border-radius: 12px; text-align: center; font-weight: 600; }
    .tab[aria-selected="true"] { outline: 2px solid var(--accent); }
    .content { display: none; }
    .content[aria-hidden="false"] { display: block; }
    .card { border: 1px solid var(--border); background: var(--card); border-radius: 14px; padding: 14px; margin: 10px 0; }
    .row { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .title { font-weight: 600; line-height: 1.35; word-wrap: break-word; overflow-wrap: anywhere; }
    .arabic { font-family: "Noto Naskh Arabic", "Amiri", "Scheherazade New", serif; font-size: 20px; display:block; margin-top:6px; line-height:1.7; }
    .muted { color: var(--muted); font-size: 12px; }
    .btn { border: 1px solid var(--border); background: #1b1c20; color: var(--text); border-radius: 10px; padding: 8px 10px; font-weight: 600; }
    .btn:active { transform: scale(0.98); }
    .btn.haptic-tap { transition: transform 90ms ease, background-color 90ms ease; }
    .btn.haptic-tap.tapped { transform: scale(0.96); outline: 2px solid rgba(79,140,255,0.25); }
    .btn.small { padding: 6px 8px; font-size: 12px; }
    .btn.counter-btn { padding: 10px 14px; font-size: 18px; min-width: 48px; min-height: 44px; }
    .counter { min-width: 56px; text-align: center; font-variant-numeric: tabular-nums; font-size: 20px; }
    .counter { min-width: 44px; text-align: center; font-variant-numeric: tabular-nums; font-size: 18px; }
    .chip { border: 1px solid var(--border); border-radius: 999px; padding: 4px 8px; }
    .good { color: var(--good); }
    .grid { display: grid; gap: 10px; }
    .grid.two { grid-template-columns: 1fr 1fr; }
    .grid.three { grid-template-columns: repeat(3, 1fr); }
    footer { margin-top: 16px; display: flex; justify-content: space-between; align-items: center; gap: 8px; flex-wrap: wrap; }
    .hidden { display: none; }
    .toolbar { display: flex; gap: 8px; }
    a { color: var(--accent); text-decoration: none; }
    @media (max-width: 520px) {
      .tabs { grid-template-columns: repeat(5, 1fr); }
    }
  
/* Prevent overlap between text and controls in rows */
.row > :first-child { flex: 1 1 auto; min-width: 0; }
.row > :last-child { flex: 0 0 auto; }
.arabic { display:block; margin-top:10px; line-height:1.9; word-break: normal; overflow-wrap: anywhere; }
.title { display:block; }

  
  .btn, button { -webkit-tap-highlight-color: rgba(255,255,255,0.1); touch-action: manipulation; }
  @keyframes tapPulse { 0%{transform:scale(1)} 50%{transform:scale(0.97)} 100%{transform:scale(1)} }
  .btn.haptic-tap.tapped { animation: tapPulse 120ms ease; }

/* ——— Info modal & button ——— */
.title-wrap{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.info-btn{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border:1px solid var(--border);border-radius:999px;background:#1b1c20;color:var(--text);font-weight:700;line-height:1;cursor:pointer}
.info-btn:active{transform:scale(.96)}
.info-btn span{font-size:12px;position:relative;top:-1px}

.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:999}
.modal-sheet{position:fixed;left:50%;top:6vh;transform:translateX(-50%);width:min(720px,92vw);max-height:calc(88vh - env(safe-area-inset-bottom));background:var(--card);border:1px solid var(--border);border-radius:14px;z-index:1000;display:flex;flex-direction:column;box-shadow:0 10px 30px rgba(0,0,0,.35)}
.modal-head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid var(--border)}
.modal-title{font-weight:700}
.modal-close{border:1px solid var(--border);background:#1b1c20;border-radius:10px;padding:6px 10px;font-weight:600}
.modal-body{padding:14px;overflow:auto}
.modal-body .arabic{font-size:22px;line-height:2; margin-top:0}    
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Post-Ṣalāh Adhkār (Hanafi)</h1>
      <div class="toolbar">
        <button id="resetAll" class="btn small" title="Reset all counters">Reset All</button>
        <button id="installBtn" class="btn small hidden">Install</button>
      </div>
    </header>

    <nav class="tabs" role="tablist" aria-label="Salah tabs">
      <button class="tab" role="tab" aria-selected="true" data-tab="fajr">Fajr</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="dhuhr">Ḍuhr</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="asr">ʿAṣr</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="maghrib">Maghrib</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="isha">ʿIshā’</button>
    </nav>

    <!-- Content panels -->
    <section class="content" id="panel-fajr" aria-hidden="false"></section>
    <section class="content" id="panel-dhuhr" aria-hidden="true"></section>
    <section class="content" id="panel-asr" aria-hidden="true"></section>
    <section class="content" id="panel-maghrib" aria-hidden="true"></section>
    <section class="content" id="panel-isha" aria-hidden="true"></section>

    <footer>
      <div class="muted">Counts are saved on your device • Works offline</div>
    </footer>
  </div>

  <script>
    // --- Data model ---
    const BASE_A = [
      { key: "astaghfirullah", label: "Astaghfirullāh", ar: "أَسْتَغْفِرُ اللَّهَ", type: "ticks", times: 3 },
      { key: "tasleem", label: "Allāhumma anta as-salām wa minka as-salām, tabārakta yā dha-l-jalāli wa-l-ikrām.", ar: "اللَّهُمَّ أَنْتَ السَّلَامُ وَمِنْكَ السَّلَامُ، تَبَارَكْتَ يَا ذَا الْجَلَالِ وَالْإِكْرَامِ.", type: "ticks", times: 1 },
      { 
        key: "kursi",
        label: "Āyat al-Kursī",
        ar: "آيَةُ الْكُرْسِيِّ",
        type: "ticks",
        times: 1,
        info: {
          title: "Āyat al-Kursī (2:255)",
          content: `
            <div class="arabic">
             ٱللَّهُ لَآ إِلَـٰهَ إِلَّا هُوَ ٱلْحَىُّ ٱلْقَيُّومُ ۚ لَا تَأْخُذُهُۥ سِنَةٌۭ وَلَا نَوْمٌۭ ۚ لَّهُۥ مَا فِى ٱلسَّمَـٰوَٰتِ وَمَا فِى ٱلْأَرْضِ ۗ مَن ذَا ٱلَّذِى يَشْفَعُ عِندَهُۥٓ إِلَّا بِإِذْنِهِۦ ۚ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ ۖ وَلَا يُحِيطُونَ بِشَىْءٍۢ مِّنْ عِلْمِهِۦٓ إِلَّا بِمَا شَآءَ ۚ وَسِعَ كُرْسِيُّهُ ٱلسَّمَـٰوَٰتِ وَٱلْأَرْضَ ۖ وَلَا يَـُٔودُهُۥ حِفْظُهُمَا ۚ وَهُوَ ٱلْعَلِىُّ ٱلْعَظِيمُ ٢٥٥
            </div>
          `
        }
      },
      { key: "quls", label: "Three Quls - al-Ikhlāṣ • al-Falaq • an-Nās", ar: "الإِخْلَاصُ • الْفَلَقُ • النَّاسُ", type: "ticks", times: 1 },
    ];
    const TASBIH = [
      { key: "subhan", label: "Subḥānallāh (33)", ar: "سُبْحَانَ اللَّهِ", type: "count", target: 33 },
      { key: "alhamd", label: "Alḥamdulillāh (33)", ar: "الْحَمْدُ لِلَّهِ", type: "count", target: 33 },
      { key: "akbar", label: "Allāhu Akbar (34)", ar: "اللَّهُ أَكْبَرُ", type: "count", target: 34 },
      
    ];
    const BENEFICIAL = [
      { key: "tahleel100", label: "Lā ilāha illa-llāhu waḥdahu lā sharīka lah, lahu-l-mulku wa lahu-l-ḥamdu wa huwa ʿalā kulli shay’in qadīr. x100", ar: "لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ.", type: "count", target: 100 },
      { key: "salawat", label: "Allāhumma ṣalli ʿalā Muḥammad, wa ʿalā āli Muḥammad.", ar: "اللَّهُمَّ صَلِّ عَلَىٰ مُحَمَّدٍ، وَعَلَىٰ آلِ مُحَمَّدٍ.", type: "ticks", times: 1 },
      { key: "lahawla", label: "Lā ḥawla wa lā quwwata illā billāh.", ar: "لَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِاللَّهِ.", type: "ticks", times: 1 },
      { key: "general", label: "Subḥānallāh / Alḥamdulillāh / Allāhu Akbar / Lā ilāha illa-llāh.", ar: "سُبْحَانَ اللَّهِ / الْحَمْدُ لِلَّهِ / اللَّهُ أَكْبَرُ / لَا إِلَهَ إِلَّا اللَّهُ", type: "ticks", times: 1 },
    ];
    const EXTRAS = {
      fajr: [
        { key: "tahleel10", label: "Lā ilāha illa-llāhu waḥdahu lā sharīka lah, lahu-l-mulku wa lahu-l-ḥamdu wa huwa ʿalā kulli shay’in qadīr. ×10", ar: "لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ.", type: "ticks", times: 10 },
        { key: "tamamat", label: "Aʿūdhu bi kalimāti-llāhi-t-tāmmāti min sharri mā khalaq.", ar: "أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ.", type: "ticks", times: 1 },
        { key: "ilmRizq", label: "Allāhumma innī as’aluka ʿilman nāfiʿan, wa rizqan ṭayyiban, wa ʿamalan mutaqabbalan.", ar: "اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا، وَرِزْقًا طَيِّبًا، وَعَمَلًا مُتَقَبَّلًا.", type: "ticks", times: 1 },
        { key: "ajirni7", label: "Allāhumma ajirnī mina-n-nār ×7", ar: "اللَّهُمَّ أَجِرْنِي مِنَ النَّارِ.", type: "ticks", times: 7 },
        { key: "subhan100", label: "Subḥānallāhi wa bi ḥamdih ×100 (throughout morning)", ar: "سُبْحَانَ اللَّهِ وَبِحَمْدِهِ.", type: "count", target: 100 },
      ],
      dhuhr: [],
      asr: [
        { key: "tamamatE", label: "Aʿūdhu bi kalimāti-llāhi-t-tāmmāti min sharri mā khalaq.", ar: "أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ.", type: "ticks", times: 1 },
        { key: "ajirni7E", label: "Allāhumma ajirnī mina-n-nār ×7", ar: "اللَّهُمَّ أَجِرْنِي مِنَ النَّارِ.", type: "ticks", times: 7 },
        { key: "tasdiq", label: "Āmannā billāhi waḥdah.", ar: "آمَنَّا بِاللَّهِ وَحْدَهُ.", type: "ticks", times: 1 },
      ],
      maghrib: [
        { key: "tahleel10M", label: "Lā ilāha illa-llāhu waḥdahu lā sharīka lah, lahu-l-mulku wa lahu-l-ḥamdu wa huwa ʿalā kulli shay’in qadīr. ×10", ar: "لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ.", type: "ticks", times: 10 },
        { 
          key: "waqiah",
          label: "Sūrat al-Wāqiʿah",
          ar: "سُورَةُ الْوَاقِعَةِ",
          type: "ticks",
          times: 1,
          info: {
            title: "Sūrat al-Wāqiʿah (56)",
            content: `
              <div class="arabic">
                إِذَا وَقَعَتِ ٱلْوَاقِعَةُ ١ لَيْسَ لِوَقْعَتِهَا كَاذِبَةٌ ٢ خَافِضَةٌۭ رَّافِعَةٌ ٣ إِذَا رُجَّتِ ٱلْأَرْضُ رَجًّۭا ٤ وَبُسَّتِ ٱلْجِبَالُ بَسًّۭا ٥ فَكَانَتْ هَبَآءًۭ مُّنۢبَثًّۭا ٦ وَكُنتُمْ أَزْوَٰجًۭا ثَلَـٰثَةًۭ ٧ فَأَصْحَـٰبُ ٱلْمَيْمَنَةِ مَآ أَصْحَـٰبُ ٱلْمَيْمَنَةِ ٨ وَأَصْحَـٰبُ ٱلْمَشْـَٔمَةِ مَآ أَصْحَـٰبُ ٱلْمَشْـَٔمَةِ ٩ وَٱلسَّـٰبِقُونَ ٱلسَّـٰبِقُونَ ١٠ أُو۟لَـٰٓئِكَ ٱلْمُقَرَّبُونَ ١١ فِى جَنَّـٰتِ ٱلنَّعِيمِ ١٢ ثُلَّةٌۭ مِّنَ ٱلْأَوَّلِينَ ١٣ وَقَلِيلٌۭ مِّنَ ٱلْـَٔاخِرِينَ ١٤ عَلَىٰ سُرُرٍۢ مَّوْضُونَةٍۢ ١٥ مُّتَّكِـِٔينَ عَلَيْهَا مُتَقَـٰبِلِينَ ١٦ يَطُوفُ عَلَيْهِمْ وِلْدَٰنٌۭ مُّخَلَّدُونَ ١٧ بِأَكْوَابٍۢ وَأَبَارِيقَ وَكَأْسٍۢ مِّن مَّعِينٍۢ ١٨ لَّا يُصَدَّعُونَ عَنْهَا وَلَا يُنزِفُونَ ١٩ وَفَـٰكِهَةٍۢ مِّمَّا يَتَخَيَّرُونَ ٢٠ وَلَحْمِ طَيْرٍۢ مِّمَّا يَشْتَهُونَ ٢١ وَحُورٌ عِينٌۭ ٢٢ كَأَمْثَـٰلِ ٱللُّؤْلُؤِ ٱلْمَكْنُونِ ٢٣ جَزَآءًۢ بِمَا كَانُوا۟ يَعْمَلُونَ ٢٤ لَا يَسْمَعُونَ فِيهَا لَغْوًۭا وَلَا تَأْثِيمًا ٢٥ إِلَّا قِيلًۭا سَلَـٰمًۭا سَلَـٰمًۭا ٢٦ وَأَصْحَـٰبُ ٱلْيَمِينِ مَآ أَصْحَـٰبُ ٱلْيَمِينِ ٢٧ فِى سِدْرٍۢ مَّخْضُودٍۢ ٢٨ وَطَلْحٍۢ مَّنضُودٍۢ ٢٩ وَظِلٍّۢ مَّمْدُودٍۢ ٣٠ وَمَآءٍۢ مَّسْكُوبٍۢ ٣١ وَفَـٰكِهَةٍۢ كَثِيرَةٍۢ ٣٢ لَّا مَقْطُوعَةٍۢ وَلَا مَمْنُوعَةٍۢ ٣٣ وَفُرُشٍۢ مَّرْفُوعَةٍ ٣٤ إِنَّآ أَنشَأْنَـٰهُنَّ إِنشَآءًۭ ٣٥ فَجَعَلْنَـٰهُنَّ أَبْكَارًا ٣٦ عُرُبًا أَتْرَابًۭا ٣٧ لِّأَصْحَـٰبِ ٱلْيَمِينِ ٣٨ ثُلَّةٌۭ مِّنَ ٱلْأَوَّلِينَ ٣٩ وَثُلَّةٌۭ مِّنَ ٱلْـَٔاخِرِينَ ٤٠ وَأَصْحَـٰبُ ٱلشِّمَالِ مَآ أَصْحَـٰبُ ٱلشِّمَالِ ٤١ فِى سَمُومٍۢ وَحَمِيمٍۢ ٤٢ وَظِلٍّۢ مِّن يَحْمُومٍۢ ٤٣ لَّا بَارِدٍۢ وَلَا كَرِيمٍ ٤٤ إِنَّهُمْ كَانُوا۟ قَبْلَ ذَٰلِكَ مُتْرَفِينَ ٤٥ وَكَانُوا۟ يُصِرُّونَ عَلَى ٱلْحِنثِ ٱلْعَظِيمِ ٤٦ وَكَانُوا۟ يَقُولُونَ أَئِذَا مِتْنَا وَكُنَّا تُرَابًۭا وَعِظَـٰمًا أَءِنَّا لَمَبْعُوثُونَ ٤٧ أَوَءَابَآؤُنَا ٱلْأَوَّلُونَ ٤٨ قُلْ إِنَّ ٱلْأَوَّلِينَ وَٱلْـَٔاخِرِينَ ٤٩ لَمَجْمُوعُونَ إِلَىٰ مِيقَـٰتِ يَوْمٍۢ مَّعْلُومٍۢ ٥٠ ثُمَّ إِنَّكُمْ أَيُّهَا ٱلضَّآلُّونَ ٱلْمُكَذِّبُونَ ٥١ لَـَٔاكِلُونَ مِن شَجَرٍۢ مِّن زَقُّومٍۢ ٥٢ فَمَالِـُٔونَ مِنْهَا ٱلْبُطُونَ ٥٣ فَشَـٰرِبُونَ عَلَيْهِ مِنَ ٱلْحَمِيمِ ٥٤ فَشَـٰرِبُونَ شُرْبَ ٱلْهِيمِ ٥٥ هَـٰذَا نُزُلُهُمْ يَوْمَ ٱلدِّينِ ٥٦ نَحْنُ خَلَقْنَـٰكُمْ فَلَوْلَا تُصَدِّقُونَ ٥٧ أَفَرَءَيْتُم مَّا تُمْنُونَ ٥٨ ءَأَنتُمْ تَخْلُقُونَهُۥٓ أَمْ نَحْنُ ٱلْخَـٰلِقُونَ ٥٩ نَحْنُ قَدَّرْنَا بَيْنَكُمُ ٱلْمَوْتَ وَمَا نَحْنُ بِمَسْبُوقِينَ ٦٠ عَلَىٰٓ أَن نُّبَدِّلَ أَمْثَـٰلَكُمْ وَنُنشِئَكُمْ فِى مَا لَا تَعْلَمُونَ ٦١ وَلَقَدْ عَلِمْتُمُ ٱلنَّشْأَةَ ٱلْأُولَىٰ فَلَوْلَا تَذَكَّرُونَ ٦٢ أَفَرَءَيْتُم مَّا تَحْرُثُونَ ٦٣ ءَأَنتُمْ تَزْرَعُونَهُۥٓ أَمْ نَحْنُ ٱلزَّٰرِعُونَ ٦٤ لَوْ نَشَآءُ لَجَعَلْنَـٰهُ حُطَـٰمًۭا فَظَلْتُمْ تَفَكَّهُونَ ٦٥ إِنَّا لَمُغْرَمُونَ ٦٦ بَلْ نَحْنُ مَحْرُومُونَ ٦٧ أَفَرَءَيْتُمُ ٱلْمَآءَ ٱلَّذِى تَشْرَبُونَ ٦٨ ءَأَنتُمْ أَنزَلْتُمُوهُ مِنَ ٱلْمُزْنِ أَمْ نَحْنُ ٱلْمُنزِلُونَ ٦٩ لَوْ نَشَآءُ جَعَلْنَـٰهُ أُجَاجًۭا فَلَوْلَا تَشْكُرُونَ ٧٠ أَفَرَءَيْتُمُ ٱلنَّارَ ٱلَّتِى تُورُونَ ٧١ ءَأَنتُمْ أَنشَأْتُمْ شَجَرَتَهَآ أَمْ نَحْنُ ٱلْمُنشِـُٔونَ ٧٢ نَحْنُ جَعَلْنَـٰهَا تَذْكِرَةًۭ وَمَتَـٰعًۭا لِّلْمُقْوِينَ ٧٣ فَسَبِّحْ بِٱسْمِ رَبِّكَ ٱلْعَظِيمِ ٧٤ ۞ فَلَآ أُقْسِمُ بِمَوَٰقِعِ ٱلنُّجُومِ ٧٥ وَإِنَّهُۥ لَقَسَمٌۭ لَّوْ تَعْلَمُونَ عَظِيمٌ ٧٦
              </div>
            `
          }
        },
      ],
      isha: [
        {
          key: "akhirBaqarah",
          label: "Ākhir al-Baqarah (2:285–286)",
          type: "ticks",
          times: 1,
          info: {
            title: "Ākhir al-Baqarah (2:285–286)",
            content: `
              <div class="arabic">
                ءَامَنَ ٱلرَّسُولُ بِمَآ أُنزِلَ إِلَيْهِ مِن رَّبِّهِۦ وَٱلْمُؤْمِنُونَ ۚ كُلٌّ ءَامَنَ بِٱللَّهِ وَمَلَـٰٓئِكَتِهِۦ وَكُتُبِهِۦ وَرُسُلِهِۦ لَا نُفَرِّقُ بَيْنَ أَحَدٍۢ مِّن رُّسُلِهِۦ ۚ وَقَالُوا۟ سَمِعْنَا وَأَطَعْنَا ۖ غُفْرَانَكَ رَبَّنَا وَإِلَيْكَ ٱلْمَصِيرُ ٢٨٥ لَا يُكَلِّفُ ٱللَّهُ نَفْسًا إِلَّا وُسْعَهَا ۚ لَهَا مَا كَسَبَتْ وَعَلَيْهَا مَا ٱكْتَسَبَتْ ۗ رَبَّنَا لَا تُؤَاخِذْنَآ إِن نَّسِينَآ أَوْ أَخْطَأْنَا ۚ رَبَّنَا وَلَا تَحْمِلْ عَلَيْنَآ إِصْرًۭا كَمَا حَمَلْتَهُۥ عَلَى ٱلَّذِينَ مِن قَبْلِنَا ۚ رَبَّنَا وَلَا تُحَمِّلْنَا مَا لَا طَاقَةَ لَنَا بِهِۦ ۖ وَٱعْفُ عَنَّا وَٱغْفِرْ لَنَا وَٱرْحَمْنَآ ۚ أَنتَ مَوْلَىٰنَا فَٱنصُرْنَا عَلَى ٱلْقَوْمِ ٱلْكَـٰفِرِينَ ٢٨٦
              </div>
            `
          }
        },
        { key: "kursiSleep", label: "Āyat al-Kursī (before sleep)", ar: "آيَةُ الْكُرْسِيِّ", type: "ticks", times: 1 },
        { 
          key: "mulk",
          label: "Sūrat al-Mulk",
          ar: "سُورَةُ الْمُلْكِ",
          type: "ticks",
          times: 1,
          info: {
            title: "Sūrat al-Mulk (67)",
            content: `
              <div class="arabic">
                تَبَـٰرَكَ ٱلَّذِى بِيَدِهِ ٱلْمُلْكُ وَهُوَ عَلَىٰ كُلِّ شَىْءٍۢ قَدِيرٌ ١ ٱلَّذِى خَلَقَ ٱلْمَوْتَ وَٱلْحَيَوٰةَ لِيَبْلُوَكُمْ أَيُّكُمْ أَحْسَنُ عَمَلًۭا ۚ وَهُوَ ٱلْعَزِيزُ ٱلْغَفُورُ ٢ ٱلَّذِى خَلَقَ سَبْعَ سَمَـٰوَٰتٍۢ طِبَاقًۭا ۖ مَّا تَرَىٰ فِى خَلْقِ ٱلرَّحْمَـٰنِ مِن تَفَـٰوُتٍۢ ۖ فَٱرْجِعِ ٱلْبَصَرَ هَلْ تَرَىٰ مِن فُطُورٍۢ ٣ ثُمَّ ٱرْجِعِ ٱلْبَصَرَ كَرَّتَيْنِ يَنقَلِبْ إِلَيْكَ ٱلْبَصَرُ خَاسِئًۭا وَهُوَ حَسِيرٌۭ ٤ وَلَقَدْ زَيَّنَّا ٱلسَّمَآءَ ٱلدُّنْيَا بِمَصَـٰبِيحَ وَجَعَلْنَـٰهَا رُجُومًۭا لِّلشَّيَـٰطِينِ ۖ وَأَعْتَدْنَا لَهُمْ عَذَابَ ٱلسَّعِيرِ ٥ وَلِلَّذِينَ كَفَرُوا۟ بِرَبِّهِمْ عَذَابُ جَهَنَّمَ ۖ وَبِئْسَ ٱلْمَصِيرُ ٦ إِذَآ أُلْقُوا۟ فِيهَا سَمِعُوا۟ لَهَا شَهِيقًۭا وَهِىَ تَفُورُ ٧ تَكَادُ تَمَيَّزُ مِنَ ٱلْغَيْظِ ۖ كُلَّمَآ أُلْقِىَ فِيهَا فَوْجٌۭ سَأَلَهُمْ خَزَنَتُهَآ أَلَمْ يَأْتِكُمْ نَذِيرٌۭ ٨ قَالُوا۟ بَلَىٰ قَدْ جَآءَنَا نَذِيرٌۭ فَكَذَّبْنَا وَقُلْنَا مَا نَزَّلَ ٱللَّهُ مِن شَىْءٍ إِنْ أَنتُمْ إِلَّا فِى ضَلَـٰلٍۢ كَبِيرٍۢ ٩ وَقَالُوا۟ لَوْ كُنَّا نَسْمَعُ أَوْ نَعْقِلُ مَا كُنَّا فِىٓ أَصْحَـٰبِ ٱلسَّعِيرِ ١٠ فَٱعْتَرَفُوا۟ بِذَنۢبِهِمْ فَسُحْقًۭا لِّأَصْحَـٰبِ ٱلسَّعِيرِ ١١ إِنَّ ٱلَّذِينَ يَخْشَوْنَ رَبَّهُم بِٱلْغَيْبِ لَهُم مَّغْفِرَةٌۭ وَأَجْرٌۭ كَبِيرٌۭ ١٢ وَأَسِرُّوا۟ قَوْلَكُمْ أَوِ ٱجْهَرُوا۟ بِهِۦٓ ۖ إِنَّهُۥ عَلِيمٌۢ بِذَاتِ ٱلصُّدُورِ ١٣ أَلَا يَعْلَمُ مَنْ خَلَقَ وَهُوَ ٱللَّطِيفُ ٱلْخَبِيرُ ١٤ هُوَ ٱلَّذِى جَعَلَ لَكُمُ ٱلْأَرْضَ ذَلُولًۭا فَٱمْشُوا۟ فِى مَنَاكِبِهَا وَكُلُوا۟ مِن رِّزْقِهِۦ ۖ وَإِلَيْهِ ٱلنُّشُورُ ١٥ ءَأَمِنتُم مَّن فِى ٱلسَّمَآءِ أَن يَخْسِفَ بِكُمُ ٱلْأَرْضَ فَإِذَا هِىَ تَمُورُ ١٦ أَمْ أَمِنتُم مَّن فِى ٱلسَّمَآءِ أَن يُرْسِلَ عَلَيْكُمْ حَاصِبًۭا ۖ فَسَتَعْلَمُونَ كَيْفَ نَذِيرِ ١٧ وَلَقَدْ كَذَّبَ ٱلَّذِينَ مِن قَبْلِهِمْ فَكَيْفَ كَانَ نَكِيرِ ١٨ أَوَلَمْ يَرَوْا۟ إِلَى ٱلطَّيْرِ فَوْقَهُمْ صَـٰٓفَّـٰتٍۢ وَيَقْبِضْنَ ۚ مَا يُمْسِكُهُنَّ إِلَّا ٱلرَّحْمَـٰنُ ۚ إِنَّهُۥ بِكُلِّ شَىْءٍۭ بَصِيرٌ ١٩ أَمَّنْ هَـٰذَا ٱلَّذِى هُوَ جُندٌۭ لَّكُمْ يَنصُرُكُم مِّن دُونِ ٱلرَّحْمَـٰنِ ۚ إِنِ ٱلْكَـٰفِرُونَ إِلَّا فِى غُرُورٍ ٢٠ أَمَّنْ هَـٰذَا ٱلَّذِى يَرْزُقُكُمْ إِنْ أَمْسَكَ رِزْقَهُۥ ۚ بَل لَّجُّوا۟ فِى عُتُوٍّۢ وَنُفُورٍ ٢١ أَفَمَن يَمْشِى مُكِبًّا عَلَىٰ وَجْهِهِۦٓ أَهْدَىٰٓ أَمَّن يَمْشِى سَوِيًّا عَلَىٰ صِرَٰطٍۢ مُّسْتَقِيمٍۢ ٢٢ قُلْ هُوَ ٱلَّذِىٓ أَنشَأَكُمْ وَجَعَلَ لَكُمُ ٱلسَّمْعَ وَٱلْأَبْصَـٰرَ وَٱلْأَفْـِٔدَةَ ۖ قَلِيلًۭا مَّا تَشْكُرُونَ ٢٣ قُلْ هُوَ ٱلَّذِى ذَرَأَكُمْ فِى ٱلْأَرْضِ وَإِلَيْهِ تُحْشَرُونَ ٢٤ وَيَقُولُونَ مَتَىٰ هَـٰذَا ٱلْوَعْدُ إِن كُنتُمْ صَـٰدِقِينَ ٢٥ قُلْ إِنَّمَا ٱلْعِلْمُ عِندَ ٱللَّهِ وَإِنَّمَآ أَنَا۠ نَذِيرٌۭ مُّبِينٌۭ ٢٦ فَلَمَّا رَأَوْهُ زُلْفَةًۭ سِيٓـَٔتْ وُجُوهُ ٱلَّذِينَ كَفَرُوا۟ وَقِيلَ هَـٰذَا ٱلَّذِى كُنتُم بِهِۦ تَدَّعُونَ ٢٧ قُلْ أَرَءَيْتُمْ إِنْ أَهْلَكَنِىَ ٱللَّهُ وَمَن مَّعِىَ أَوْ رَحِمَنَا فَمَن يُجِيرُ ٱلْكَـٰفِرِينَ مِنْ عَذَابٍ أَلِيمٍۢ ٢٨ قُلْ هُوَ ٱلرَّحْمَـٰنُ ءَامَنَّا بِهِۦ وَعَلَيْهِ تَوَكَّلْنَا ۖ فَسَتَعْلَمُونَ مَنْ هُوَ فِى ضَلَـٰلٍۢ مُّبِينٍۢ ٢٩ قُلْ أَرَءَيْتُمْ إِنْ أَصْبَحَ مَآؤُكُمْ غَوْرًۭا فَمَن يَأْتِيكُم بِمَآءٍۢ مَّعِينٍۭ ٣٠
              </div>
            `
          }
        },
      ]
    };

    const QULS_TIMES = { fajr: 3, maghrib: 3, default: 1 };

    // --- State persistence ---
    const KEY = "adhkar-v1";
    const state = JSON.parse(localStorage.getItem(KEY) || "{}");
    function save() { localStorage.setItem(KEY, JSON.stringify(state)); }

    // --- UI helpers ---
    function mkEl(tag, attrs={}, ...children) {
      const el = document.createElement(tag);
      Object.entries(attrs).forEach(([k,v]) => {
        if (k === "class") el.className = v;
        else if (k.startsWith("on") && typeof v === "function") {
          const evt = k.slice(2).toLowerCase();
          el.addEventListener(evt, v, false);
        }
        else if (k === "aria-hidden") el.setAttribute("aria-hidden", String(v));
        else if (k === "aria-selected") el.setAttribute("aria-selected", String(v));
        else el.setAttribute(k, v);
      });
      children.forEach(c => { if (c!=null) el.appendChild(typeof c==="string" ? document.createTextNode(c) : c); });
      if (tag.toLowerCase() === 'button') el.classList.add('haptic-tap');
  return el;
    }

    function ticksRow(salah, item) {
      const saved = (state[salah]?.[item.key] ?? 0);
      const total = item.times;
      // Build the left-hand column (title + optional info button + Arabic + target)
      const leftCol = mkEl("div", {},
  // Title + (optional) info button
  (()=>{
      const wrap = mkEl("div", { class: "title-wrap" },
          mkEl("div", { class: "title" }, item.label)
        );
        if (item.info && item.info.title && item.info.content) {
          const ib = mkEl("button", {
            class: "info-btn",
            onClick: () => openInfoModal(item.info.title, item.info.content)
          }, mkEl("span", {}, "i"));
          wrap.appendChild(ib);
        }
        return wrap;
      })(),
      // Arabic line (if present)
      item.ar ? mkEl("div", { class: "arabic" }, item.ar) : null,
      // Target line
      mkEl("div", { class: "muted" }, `Target: ${total}`)
    );

// Now build the full row, using leftCol on the left and keeping the grid on the right
      const row = mkEl("div", { class: "card" },
        mkEl("div", { class: "row" },
          leftCol,
          mkEl("div", { class: "grid three", style: "width: 180px;" }) // your tick buttons will render here in draw()
        ),
        mkEl("div", { class: "row", style: "margin-top:8px" },
          mkEl("button", { class: "btn small", onClick: () => set(0) }, "Reset"),
          mkEl("div", { class: "good" }, (saved >= total) ? "✓ Done" : "")
        )
      );


      const grid = row.querySelector(".grid");
      function draw(n) {
  grid.innerHTML = "";
  // Dynamic layout:
  if (total === 1) {
    grid.className = "";
    grid.style.width = "auto";
    grid.style.display = "inline-flex";
  } else {
    grid.className = "grid three";
    const w = Math.min(total * 58, 180);
    grid.style.width = w + "px";
    grid.style.display = "";
  }
  for (let i = 0; i < total; i++) {
    const on = i < n;
    const b = mkEl("button", { class: "btn small", onClick: () => toggle(i) }, on ? "✓" : `${i+1}×`);
    if (on) b.style.background = "linear-gradient(0deg,#1f4,#1f4)";
    grid.appendChild(b);
  }
}
      function set(n) {
        state[salah] = state[salah] || {};
        state[salah][item.key] = n; save(); draw(n);
        row.querySelector(".good").textContent = (n >= total) ? "✓ Done" : "";
      }
      function toggle(i) {
        let n = (state[salah]?.[item.key] ?? 0);
        if (i < n) n = i; else n = i+1;
        set(n);
      }
      draw(saved);
      return row;
    }

    function countRow(salah, item) {
      const saved = (state[salah]?.[item.key] ?? 0);
      const target = item.target;
      const row = mkEl("div", { class: "card" },
        mkEl("div", { class: "row" },
          mkEl("div", {},
            mkEl("div", { class: "title" }, item.label),
            mkEl("div", { class: "arabic" }, item.ar),
            mkEl("div", { class: "muted" }, `Target: ${target}`),
          ),
          mkEl("div", { class: "row" },
            mkEl("button", { class: "btn counter-btn", onClick: () => dec() }, "−"),
            mkEl("div", { class: "counter" }, saved.toString() ),
            mkEl("button", { class: "btn counter-btn", onClick: () => inc() }, "+")
          )
        ),
        mkEl("div", { class: "row", style: "margin-top:8px" },
          mkEl("button", { class: "btn small", onClick: () => set(0) }, "Reset"),
          mkEl("div", { class: "good" }, (saved >= target) ? "✓ Done" : "")
        )
      );
      let count = saved;
      const counterEl = row.querySelector(".counter");
      function render() {
        counterEl.textContent = count;
        row.querySelector(".good").textContent = (count >= target) ? "✓ Done" : "";
      }
      function set(n) {
        count = Math.max(0, n);
        state[salah] = state[salah] || {};
        state[salah][item.key] = count; save(); render();
      }
      function inc(){ set(count+1); }
      function dec(){ set(count-1); }
      render();
      return row;
    }

    function sectionTitle(text, sub="") {
      return mkEl("div", { class:"row", style:"margin:8px 0" },
        mkEl("div", {},
          mkEl("div", { class:"title" }, text),
          sub ? mkEl("div", { class:"muted" }, sub) : mkEl("span", {})
        )
      );
    }

    function buildPanel(key) {
      const panel = document.getElementById("panel-" + key);
      panel.innerHTML = "";
      panel.appendChild(sectionTitle("Highly recommended", "Do these first"));
      const aItems = BASE_A.map(i => (i.key === "quls" ? { ...i, times: (key in QULS_TIMES? QULS_TIMES[key] : QULS_TIMES.default) } : i));
      aItems.forEach(i => panel.appendChild(ticksRow(key, i)));

      panel.appendChild(sectionTitle("Tasbīḥ Fāṭimah", "Use tap-to-count"));
      TASBIH.forEach(i => {
        if (i.type === "count") panel.appendChild(countRow(key, i));
        else panel.appendChild(ticksRow(key, i));
      });

      if (EXTRAS[key] && EXTRAS[key].length) {
        panel.appendChild(sectionTitle("Salah specific extras", "Beneficial (fadā’il)"));
        EXTRAS[key].forEach(i => {
          if (i.type === "count") panel.appendChild(countRow(key, i));
          else panel.appendChild(ticksRow(key, i));
        });
      }

      panel.appendChild(sectionTitle("Beneficial add-ons"));
      BENEFICIAL.forEach(i => { if (i.type === 'count') panel.appendChild(countRow(key, i)); else panel.appendChild(ticksRow(key, i)); });
    }

    ["fajr","dhuhr","asr","maghrib","isha"].forEach(buildPanel);

    // Tabs
    document.querySelectorAll(".tab").forEach(tab => {
      tab.addEventListener("click", () => {
        const t = tab.getAttribute("data-tab");
        document.querySelectorAll(".tab").forEach(b => b.setAttribute("aria-selected", b===tab ? "true":"false"));
        document.querySelectorAll(".content").forEach(p => p.setAttribute("aria-hidden", p.id !== "panel-" + t ? "true":"false"));
      });
    });

    // Reset all
    document.getElementById("resetAll").addEventListener("click", () => {
      if (!confirm("Reset all counters?")) return;
      localStorage.removeItem(KEY);
      location.reload();
    });

    // PWA install prompt (for Android/desktop; iOS uses Add to Home Screen)
    let deferredPrompt;
    const installBtn = document.getElementById("installBtn");
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.classList.remove("hidden");
    });
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBtn.classList.add("hidden");
    });

    // Service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(console.error);
      });
    }
  
// --- Haptic-like tap feedback (visual; vibrate where allowed) ---
function tapFeedback(el) {
  // Visual micro-tap
  el.classList.add('tapped');
  setTimeout(() => el.classList.remove('tapped'), 110);
  // Optional vibration where supported (Android); iOS ignores gracefully
  if (navigator.vibrate) {
    try { navigator.vibrate(10); } catch (e) {}
  }
}


// Delegated haptic-like feedback for all buttons with .haptic-tap
(function(){
  function should(el){ return el && el.classList && el.classList.contains('haptic-tap'); }
  document.addEventListener('touchstart', function(e){
    const el = e.target.closest('button');
    if (should(el)) { el.classList.add('tapped'); setTimeout(()=>el.classList.remove('tapped'), 140); }
  }, {passive:true});
  document.addEventListener('click', function(e){
    const el = e.target.closest('button');
    if (should(el)) { el.classList.add('tapped'); setTimeout(()=>el.classList.remove('tapped'), 120); }
  });
})();

// ——— Modal helpers ———
function openInfoModal(title, htmlContent){
  const overlay = document.createElement('div');
  overlay.className = 'modal-overlay';
  overlay.addEventListener('click', (e)=>{ if(e.target===overlay) close(); });

  const sheet = document.createElement('div');
  sheet.className = 'modal-sheet';
  sheet.innerHTML = `
    <div class="modal-head">
      <div class="modal-title">${title}</div>
      <button class="modal-close">Close</button>
    </div>
    <div class="modal-body">${htmlContent}</div>
  `;
  overlay.appendChild(sheet);
  document.body.appendChild(overlay);

  function onEsc(ev){ if(ev.key==='Escape') close(); }
  function close(){
    document.removeEventListener('keydown', onEsc);
    overlay.remove();
  }
  sheet.querySelector('.modal-close').addEventListener('click', close);
  document.addEventListener('keydown', onEsc);
}
    
</script>
</body>
</html>
