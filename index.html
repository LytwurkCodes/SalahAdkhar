
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
  <title>Post-Ṣalāh Adhkār (Hanafi)</title>
  <meta name="description" content="Phone-friendly offline checklist of post-ṣalāh adhkār (Hanafi) with Arabic and transliteration, tap-to-count, and local save.">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0a0a0a">
  <!-- iOS PWA meta -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Adhkar">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <style>
    :root {
      --bg: #0b0b0c;
      --card: #141416;
      --muted: #9aa0a6;
      --text: #f1f3f4;
      --accent: #4f8cff;
      --good: #22c55e;
      --border: #2a2b2f;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; padding: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: var(--bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .container { max-width: 920px; margin: 0 auto; padding: calc(16px + env(safe-area-inset-top) + 8px) 16px calc(20px + env(safe-area-inset-bottom)); }
    header { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    h1 { margin: 0; font-size: 20px; }
    .tabs { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin: 12px 0 8px; }
    .tab { padding: 10px 8px; border: 1px solid var(--border); background: var(--card); color: var(--text); border-radius: 12px; text-align: center; font-weight: 600; }
    .tab[aria-selected="true"] { outline: 2px solid var(--accent); }
    .content { display: none; }
    .content[aria-hidden="false"] { display: block; }
    .card { border: 1px solid var(--border); background: var(--card); border-radius: 14px; padding: 14px; margin: 10px 0; }
    .row { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .title { font-weight: 600; line-height: 1.35; word-wrap: break-word; overflow-wrap: anywhere; }
    .arabic { font-family: "Noto Naskh Arabic", "Amiri", "Scheherazade New", serif; font-size: 20px; display:block; margin-top:6px; line-height:1.7; }
    .muted { color: var(--muted); font-size: 12px; }
    .btn { border: 1px solid var(--border); background: #1b1c20; color: var(--text); border-radius: 10px; padding: 8px 10px; font-weight: 600; }
    .btn:active { transform: scale(0.98); }
    .btn.haptic-tap { transition: transform 90ms ease, background-color 90ms ease; }
    .btn.haptic-tap.tapped { transform: scale(0.96); outline: 2px solid rgba(79,140,255,0.25); }
    .btn.small { padding: 6px 8px; font-size: 12px; }
    .btn.counter-btn { padding: 10px 14px; font-size: 18px; min-width: 48px; min-height: 44px; }
    .counter { min-width: 56px; text-align: center; font-variant-numeric: tabular-nums; font-size: 20px; }
    .counter { min-width: 44px; text-align: center; font-variant-numeric: tabular-nums; font-size: 18px; }
    .chip { border: 1px solid var(--border); border-radius: 999px; padding: 4px 8px; }
    .good { color: var(--good); }
    .grid { display: grid; gap: 10px; }
    .grid.two { grid-template-columns: 1fr 1fr; }
    .grid.three { grid-template-columns: repeat(3, 1fr); }
    footer { margin-top: 16px; display: flex; justify-content: space-between; align-items: center; gap: 8px; flex-wrap: wrap; }
    .hidden { display: none; }
    .toolbar { display: flex; gap: 8px; }
    a { color: var(--accent); text-decoration: none; }
    @media (max-width: 520px) {
      .tabs { grid-template-columns: repeat(5, 1fr); }
    }
  
/* Prevent overlap between text and controls in rows */
.row > :first-child { flex: 1 1 auto; min-width: 0; }
.row > :last-child { flex: 0 0 auto; }
.arabic { display:block; margin-top:10px; line-height:1.9; word-break: normal; overflow-wrap: anywhere; }
.title { display:block; }

  
  .btn, button { -webkit-tap-highlight-color: rgba(255,255,255,0.1); touch-action: manipulation; }
  @keyframes tapPulse { 0%{transform:scale(1)} 50%{transform:scale(0.97)} 100%{transform:scale(1)} }
  .btn.haptic-tap.tapped { animation: tapPulse 120ms ease; }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Post-Ṣalāh Adhkār (Hanafi)</h1>
      <div class="toolbar">
        <button id="resetAll" class="btn small" title="Reset all counters">Reset All</button>
        <button id="installBtn" class="btn small hidden">Install</button>
      </div>
    </header>

    <nav class="tabs" role="tablist" aria-label="Salah tabs">
      <button class="tab" role="tab" aria-selected="true" data-tab="fajr">Fajr</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="dhuhr">Ḍuhr</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="asr">ʿAṣr</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="maghrib">Maghrib</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="isha">ʿIshā’</button>
    </nav>

    <!-- Content panels -->
    <section class="content" id="panel-fajr" aria-hidden="false"></section>
    <section class="content" id="panel-dhuhr" aria-hidden="true"></section>
    <section class="content" id="panel-asr" aria-hidden="true"></section>
    <section class="content" id="panel-maghrib" aria-hidden="true"></section>
    <section class="content" id="panel-isha" aria-hidden="true"></section>

    <footer>
      <div class="muted">Counts are saved on your device • Works offline</div>
      <div class="muted">Tip: iOS → Share → <strong>Add to Home Screen</strong></div>
    </footer>
  </div>

  <script>
    // --- Data model ---
    const BASE_A = [
      { key: "astaghfirullah", label: "Astaghfirullāh", ar: "أَسْتَغْفِرُ اللَّهَ", type: "ticks", times: 3 },
      { key: "tasleem", label: "Allāhumma anta as-salām wa minka as-salām, tabārakta yā dha-l-jalāli wa-l-ikrām.", ar: "اللَّهُمَّ أَنْتَ السَّلَامُ وَمِنْكَ السَّلَامُ، تَبَارَكْتَ يَا ذَا الْجَلَالِ وَالْإِكْرَامِ.", type: "ticks", times: 1 },
      { key: "kursi", label: "Āyat al-Kursī", ar: "آيَةُ الْكُرْسِيِّ", type: "ticks", times: 1 },
      { key: "quls", label: "Three Quls - al-Ikhlāṣ • al-Falaq • an-Nās", ar: "الإِخْلَاصُ • الْفَلَقُ • النَّاسُ", type: "ticks", times: 1 },
    ];
    const TASBIH = [
      { key: "subhan", label: "Subḥānallāh (33)", ar: "سُبْحَانَ اللَّهِ", type: "count", target: 33 },
      { key: "alhamd", label: "Alḥamdulillāh (33)", ar: "الْحَمْدُ لِلَّهِ", type: "count", target: 33 },
      { key: "akbar", label: "Allāhu Akbar (34)", ar: "اللَّهُ أَكْبَرُ", type: "count", target: 34 },
      
    ];
    const BENEFICIAL = [
      { key: "tahleel100", label: "Lā ilāha illa-llāhu waḥdahu lā sharīka lah, lahu-l-mulku wa lahu-l-ḥamdu wa huwa ʿalā kulli shay’in qadīr. x100", ar: "لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ.", type: "count", target: 100 },
      { key: "salawat", label: "Allāhumma ṣalli ʿalā Muḥammad, wa ʿalā āli Muḥammad.", ar: "اللَّهُمَّ صَلِّ عَلَىٰ مُحَمَّدٍ، وَعَلَىٰ آلِ مُحَمَّدٍ.", type: "ticks", times: 1 },
      { key: "lahawla", label: "Lā ḥawla wa lā quwwata illā billāh.", ar: "لَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِاللَّهِ.", type: "ticks", times: 1 },
      { key: "general", label: "Subḥānallāh / Alḥamdulillāh / Allāhu Akbar / Lā ilāha illa-llāh.", ar: "سُبْحَانَ اللَّهِ / الْحَمْدُ لِلَّهِ / اللَّهُ أَكْبَرُ / لَا إِلَهَ إِلَّا اللَّهُ", type: "ticks", times: 1 },
    ];
    const EXTRAS = {
      fajr: [
        { key: "tahleel10", label: "Lā ilāha illa-llāhu waḥdahu lā sharīka lah, lahu-l-mulku wa lahu-l-ḥamdu wa huwa ʿalā kulli shay’in qadīr. ×10", ar: "لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ.", type: "ticks", times: 10 },
        { key: "tamamat", label: "Aʿūdhu bi kalimāti-llāhi-t-tāmmāti min sharri mā khalaq.", ar: "أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ.", type: "ticks", times: 1 },
        { key: "ilmRizq", label: "Allāhumma innī as’aluka ʿilman nāfiʿan, wa rizqan ṭayyiban, wa ʿamalan mutaqabbalan.", ar: "اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا، وَرِزْقًا طَيِّبًا، وَعَمَلًا مُتَقَبَّلًا.", type: "ticks", times: 1 },
        { key: "ajirni7", label: "Allāhumma ajirnī mina-n-nār ×7", ar: "اللَّهُمَّ أَجِرْنِي مِنَ النَّارِ.", type: "ticks", times: 7 },
        { key: "subhan100", label: "Subḥānallāhi wa bi ḥamdih ×100 (across morning)", ar: "سُبْحَانَ اللَّهِ وَبِحَمْدِهِ.", type: "count", target: 100 },
      ],
      dhuhr: [],
      asr: [
        { key: "tamamatE", label: "Aʿūdhu bi kalimāti-llāhi-t-tāmmāti min sharri mā khalaq.", ar: "أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ.", type: "ticks", times: 1 },
        { key: "ajirni7E", label: "Allāhumma ajirnī mina-n-nār ×7", ar: "اللَّهُمَّ أَجِرْنِي مِنَ النَّارِ.", type: "ticks", times: 7 },
        { key: "tasdiq", label: "Āmannā billāhi waḥdah.", ar: "آمَنَّا بِاللَّهِ وَحْدَهُ.", type: "ticks", times: 1 },
      ],
      maghrib: [
        { key: "tahleel10M", label: "Lā ilāha illa-llāhu waḥdahu lā sharīka lah, lahu-l-mulku wa lahu-l-ḥamdu wa huwa ʿalā kulli shay’in qadīr. ×10", ar: "لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ.", type: "ticks", times: 10 },
        { key: "waqiah", label: "Sūrat al-Wāqiʿah (virtuous practice)", ar: "سُورَةُ الْوَاقِعَةِ", type: "ticks", times: 1 },
      ],
      isha: [
        { key: "akhirBaqarah", label: "Ākhir al-Baqarah (2:285–286)", ar: "آمَنَ الرَّسُولُ … إِلَىٰ آخِرِ السُّورَةِ", type: "ticks", times: 1 },
        { key: "kursiSleep", label: "Āyat al-Kursī (before sleep)", ar: "آيَةُ الْكُرْسِيِّ", type: "ticks", times: 1 },
        { key: "mulk", label: "Sūrat al-Mulk", ar: "سُورَةُ الْمُلْكِ", type: "ticks", times: 1 },
      ]
    };

    const QULS_TIMES = { fajr: 3, maghrib: 3, default: 1 };

    // --- State persistence ---
    const KEY = "adhkar-v1";
    const state = JSON.parse(localStorage.getItem(KEY) || "{}");
    function save() { localStorage.setItem(KEY, JSON.stringify(state)); }

    // --- UI helpers ---
    function mkEl(tag, attrs={}, ...children) {
      const el = document.createElement(tag);
      Object.entries(attrs).forEach(([k,v]) => {
        if (k === "class") el.className = v;
        else if (k.startsWith("on") && typeof v === "function") {
          const evt = k.slice(2).toLowerCase();
          el.addEventListener(evt, v, false);
        }
        else if (k === "aria-hidden") el.setAttribute("aria-hidden", String(v));
        else if (k === "aria-selected") el.setAttribute("aria-selected", String(v));
        else el.setAttribute(k, v);
      });
      children.forEach(c => { if (c!=null) el.appendChild(typeof c==="string" ? document.createTextNode(c) : c); });
      if (tag.toLowerCase() === 'button') el.classList.add('haptic-tap');
  return el;
    }

    function ticksRow(salah, item) {
      const saved = (state[salah]?.[item.key] ?? 0);
      const total = item.times;
      const row = mkEl("div", { class: "card" },
        mkEl("div", { class: "row" },
          mkEl("div", {},
            mkEl("div", { class: "title" }, item.label),
            mkEl("div", { class: "arabic" }, item.ar),
            mkEl("div", { class: "muted" }, `Target: ${total}`),
          ),
          mkEl("div", { class: "grid three", style: "width: 180px;" })
        ),
        mkEl("div", { class: "row", style: "margin-top:8px" },
          mkEl("button", { class: "btn small", onClick: () => set(0) }, "Reset"),
          mkEl("div", { class: "good" }, (saved >= total) ? "✓ Done" : "")
        )
      );

      const grid = row.querySelector(".grid");
      function draw(n) {
  grid.innerHTML = "";
  // Dynamic layout:
  if (total === 1) {
    grid.className = "";
    grid.style.width = "auto";
    grid.style.display = "inline-flex";
  } else {
    grid.className = "grid three";
    const w = Math.min(total * 58, 180);
    grid.style.width = w + "px";
    grid.style.display = "";
  }
  for (let i = 0; i < total; i++) {
    const on = i < n;
    const b = mkEl("button", { class: "btn small", onClick: () => toggle(i) }, on ? "✓" : `${i+1}×`);
    if (on) b.style.background = "linear-gradient(0deg,#1f4,#1f4)";
    grid.appendChild(b);
  }
}
      function set(n) {
        state[salah] = state[salah] || {};
        state[salah][item.key] = n; save(); draw(n);
        row.querySelector(".good").textContent = (n >= total) ? "✓ Done" : "";
      }
      function toggle(i) {
        let n = (state[salah]?.[item.key] ?? 0);
        if (i < n) n = i; else n = i+1;
        set(n);
      }
      draw(saved);
      return row;
    }

    function countRow(salah, item) {
      const saved = (state[salah]?.[item.key] ?? 0);
      const target = item.target;
      const row = mkEl("div", { class: "card" },
        mkEl("div", { class: "row" },
          mkEl("div", {},
            mkEl("div", { class: "title" }, item.label),
            mkEl("div", { class: "arabic" }, item.ar),
            mkEl("div", { class: "muted" }, `Target: ${target}`),
          ),
          mkEl("div", { class: "row" },
            mkEl("button", { class: "btn counter-btn", onClick: () => dec() }, "−"),
            mkEl("div", { class: "counter" }, saved.toString() ),
            mkEl("button", { class: "btn counter-btn", onClick: () => inc() }, "+")
          )
        ),
        mkEl("div", { class: "row", style: "margin-top:8px" },
          mkEl("button", { class: "btn small", onClick: () => set(0) }, "Reset"),
          mkEl("div", { class: "good" }, (saved >= target) ? "✓ Done" : "")
        )
      );
      let count = saved;
      const counterEl = row.querySelector(".counter");
      function render() {
        counterEl.textContent = count;
        row.querySelector(".good").textContent = (count >= target) ? "✓ Done" : "";
      }
      function set(n) {
        count = Math.max(0, n);
        state[salah] = state[salah] || {};
        state[salah][item.key] = count; save(); render();
      }
      function inc(){ set(count+1); }
      function dec(){ set(count-1); }
      render();
      return row;
    }

    function sectionTitle(text, sub="") {
      return mkEl("div", { class:"row", style:"margin:8px 0" },
        mkEl("div", {},
          mkEl("div", { class:"title" }, text),
          sub ? mkEl("div", { class:"muted" }, sub) : mkEl("span", {})
        )
      );
    }

    function buildPanel(key) {
      const panel = document.getElementById("panel-" + key);
      panel.innerHTML = "";
      panel.appendChild(sectionTitle("Highly recommended (A)", "Do these first"));
      const aItems = BASE_A.map(i => (i.key === "quls" ? { ...i, times: (key in QULS_TIMES? QULS_TIMES[key] : QULS_TIMES.default) } : i));
      aItems.forEach(i => panel.appendChild(ticksRow(key, i)));

      panel.appendChild(sectionTitle("Tasbīḥ Fāṭimah", "Use tap-to-count"));
      TASBIH.forEach(i => {
        if (i.type === "count") panel.appendChild(countRow(key, i));
        else panel.appendChild(ticksRow(key, i));
      });

      if (EXTRAS[key] && EXTRAS[key].length) {
        panel.appendChild(sectionTitle("Time-specific extras", "Beneficial (fadā’il)"));
        EXTRAS[key].forEach(i => {
          if (i.type === "count") panel.appendChild(countRow(key, i));
          else panel.appendChild(ticksRow(key, i));
        });
      }

      panel.appendChild(sectionTitle("Beneficial add-ons (B)"));
      BENEFICIAL.forEach(i => { if (i.type === 'count') panel.appendChild(countRow(key, i)); else panel.appendChild(ticksRow(key, i)); });
    }

    ["fajr","dhuhr","asr","maghrib","isha"].forEach(buildPanel);

    // Tabs
    document.querySelectorAll(".tab").forEach(tab => {
      tab.addEventListener("click", () => {
        const t = tab.getAttribute("data-tab");
        document.querySelectorAll(".tab").forEach(b => b.setAttribute("aria-selected", b===tab ? "true":"false"));
        document.querySelectorAll(".content").forEach(p => p.setAttribute("aria-hidden", p.id !== "panel-" + t ? "true":"false"));
      });
    });

    // Reset all
    document.getElementById("resetAll").addEventListener("click", () => {
      if (!confirm("Reset all counters?")) return;
      localStorage.removeItem(KEY);
      location.reload();
    });

    // PWA install prompt (for Android/desktop; iOS uses Add to Home Screen)
    let deferredPrompt;
    const installBtn = document.getElementById("installBtn");
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.classList.remove("hidden");
    });
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBtn.classList.add("hidden");
    });

    // Service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(console.error);
      });
    }
  
// --- Haptic-like tap feedback (visual; vibrate where allowed) ---
function tapFeedback(el) {
  // Visual micro-tap
  el.classList.add('tapped');
  setTimeout(() => el.classList.remove('tapped'), 110);
  // Optional vibration where supported (Android); iOS ignores gracefully
  if (navigator.vibrate) {
    try { navigator.vibrate(10); } catch (e) {}
  }
}


// Delegated haptic-like feedback for all buttons with .haptic-tap
(function(){
  function should(el){ return el && el.classList && el.classList.contains('haptic-tap'); }
  document.addEventListener('touchstart', function(e){
    const el = e.target.closest('button');
    if (should(el)) { el.classList.add('tapped'); setTimeout(()=>el.classList.remove('tapped'), 140); }
  }, {passive:true});
  document.addEventListener('click', function(e){
    const el = e.target.closest('button');
    if (should(el)) { el.classList.add('tapped'); setTimeout(()=>el.classList.remove('tapped'), 120); }
  });
})();

</script>
</body>
</html>
